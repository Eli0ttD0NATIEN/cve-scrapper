"use strict";

const cmdParser = require('./CmdParser').CmdParser;
const vulnScrapper = require('./VulnScrapper').VulnScrapper;
const yargs = require('yargs');
const ARGS = yargs.argv;
const exit = yargs.exit;
const CVE_URL =  "https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=";


let main = () => {
    let CmdParserObj = new cmdParser(ARGS);
    let param = CmdParserObj.getParam();
    console.log("- Looking for Vulnerability -");
    console.log("Used Products : " + param['products']);
    let vulnScrapperObj = new vulnScrapper(CVE_URL, param['products'], param['last']);
    vulnScrapperObj.setVuln().then(() => {
        let vuln = vulnScrapperObj.getVuln();
        if(vuln.length > 0) {
            console.log('\n- Finded Vulnerabilites -')
            if(vulnScrapperObj.last){
                console.log(vuln);
                exit(0);
            }else{
                let i = 0;
                while(i < vuln.length){
                    console.log("- Vulnerability N-" + i+1)
                    console.log("\n" + vuln[i]);
                    i++;
                }
                exit(0);
            }
        } else {
            console.log('\n- No Vulnerability Found -');
            exit(0);
        }
    })
}

main();
